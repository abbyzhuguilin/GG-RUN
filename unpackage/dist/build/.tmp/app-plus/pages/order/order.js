(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/order"],{"1edc":function(e,r,t){"use strict";var n={"uni-popup":function(){return t.e("components/uni-popup/uni-popup").then(t.bind(null,"8f1d"))}},i=function(){var e=this,r=e.$createElement;e._self._c},s=[];t.d(r,"b",(function(){return i})),t.d(r,"c",(function(){return s})),t.d(r,"a",(function(){return n}))},"3be6":function(e,r,t){"use strict";var n=t("ad9e"),i=t.n(n);i.a},"4ef7":function(e,r,t){"use strict";t.r(r);var n=t("1edc"),i=t("9080");for(var s in i)"default"!==s&&function(e){t.d(r,e,(function(){return i[e]}))}(s);t("9dd6"),t("3be6");var a,o=t("f0c5"),d=Object(o["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],a);r["default"]=d.exports},"5d0d":function(e,r,t){},"79df":function(e,r,t){"use strict";(function(e){t("7207"),t("921b");n(t("66fd"));var r=n(t("4ef7"));function n(e){return e&&e.__esModule?e:{default:e}}e(r.default)}).call(this,t("6e42")["createPage"])},"7d9f":function(e,r,t){"use strict";(function(e,n){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=a(t("4795")),s=a(t("74ab"));function a(e){return e&&e.__esModule?e:{default:e}}function o(e){return l(e)||u(e)||c(e)||d()}function d(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,r){if(e){if("string"===typeof e)return f(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(t):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?f(e,r):void 0}}function u(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function l(e){if(Array.isArray(e))return f(e)}function f(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function p(e,r,t,n,i,s,a){try{var o=e[s](a),d=o.value}catch(c){return void t(c)}o.done?r(d):Promise.resolve(d).then(n,i)}function h(e){return function(){var r=this,t=arguments;return new Promise((function(n,i){var s=e.apply(r,t);function a(e){p(s,n,i,a,o,"next",e)}function o(e){p(s,n,i,a,o,"throw",e)}a(void 0)}))}}var m=function(){t.e("components/uni-popup/uni-popup").then(function(){return resolve(t("8f1d"))}.bind(null,t)).catch(t.oe)},g={mixins:[s.default],onLoad:function(r){var t=this,n=e.createSelectorQuery().in(this);n.select(".scroll-item").boundingClientRect((function(e){t.scrollWidth=e.width})).exec(),this.cancelModelProp(),this.hasFlag=!0,this.orderList=[],this.i=0,this.orderArr=[],this.orderArrLength=0,this.priceArr=[],this.showCancelModel=!1,this.realyCancel=!1,this.initMyInfo(),this.initOrder();var i=getCurrentPages(),s=i[i.length-1];this.currentWebview=s.$getAppWebview(),this.currentWebview.setStyle({pullToRefresh:{support:!1}})},onShow:function(){var r=this;e.getStorageSync("userSelect")&&(this.currentIndex=e.getStorageSync("userSelect"),this.initOrder(),e.removeStorageSync("userSelect")),e.removeStorageSync("orderDetailInfo"),this.initOrder(),e.getStorageSync("orderRefresh")&&setTimeout((function(){r.handleCurrent(r.currentIndex),e.removeStorageSync("orderRefresh")}),500)},onHide:function(){e.hideLoading(),this.showCancelModel=!1,this.$refs.popupPay.close()},onTabItemTap:function(e){this.initOrder()},components:{uniPopup:m},data:function(){return{secondsSCT:0,scrollList:[{id:"waitpay",name:"待支付",value:1},{id:"waitjiedan",name:"待接单",value:2},{id:"waitshouqu",name:"待收取",value:3},{id:"loding",name:"进行中",value:4},{id:"evaluate",name:"待评价",value:5},{id:"complete",name:"已完成",value:6},{id:"cancel",name:"已取消",value:0},{id:"questions",name:"问题订单",value:7}],currentIndex:0,toChildView:"",swiperHeight:684,orderList:[],orderArr:[],i:0,orderArrLength:0,hasFlag:!0,scrollLeft:0,noOrderText:"",timerId:"",currentWebview:"",switchTabFlag:!0,showCancelModel:!1,realyCancel:!1,cancelTimer:0,cancelPrice:0,orderRealyId:0,priceArr:[],payInfo:[{image:"../../static/img/my/yuezhifu.png",text:"余额支付",sectext:""},{image:"../../static/img/my/Alipaypayment.png",text:"支付宝支付（推荐）\t",sectext:""},{image:"../../static/img/my/weixinzhifu.png",text:"微信支付",sectext:""}],circleShow:0,waitPayamount:0,waitpayOrderId:0,deleteId:0,swiperItem1:[],swiperItem2:[],swiperItem3:[],swiperItem4:[],swiperItem5:[],swiperItem6:[],swiperItem7:[],swiperItem8:[],priceArr1:[],priceArr2:[],priceArr3:[],priceArr4:[],priceArr5:[],priceArr6:[],priceArr7:[],priceArr8:[],resTotal:0,firstPushArr:[],touchEndY:0,touchStartY:0,touchTimer:"",upOption:{use:!1},downOption:{offset:30},pickUpTimerFlag:[],estimatedTimerFlag:[]}},computed:{orderListLength:function(){return this.orderList.length},paotuifei:function(e,r){return Number(e-r).toFixed(2)}},methods:{downCallback:function(){var e=this;setTimeout((function(){e.hasFlag=!0,e.orderList=[],e.i=0,e.orderArr=[],e.orderArrLength=0,e.priceArr=[],e.initOrder()}),1e3),this.mescroll.endDownScroll()},touchenditem:function(e){n("log",e," at pages\\order\\order.vue:935")},touchmoveDemo:function(e){n("log",e," at pages\\order\\order.vue:970"),this.touchEndY=e.changedTouches[0].pageY,n("log",this.touchEndY," at pages\\order\\order.vue:973"),n("log",this.touchStartY," at pages\\order\\order.vue:974"),this.touchEndY-this.touchStartY?(this.currentWebview.setStyle({pullToRefresh:{support:!0,style:"Android"===plus.os.name?"circle":"default"}}),""==this.touchTimer&&null==this.touchTimer||(clearTimeout(this.touchTimer),this.touchTimer=null),this.secondsSCT=0):this.currentWebview.setStyle({pullToRefresh:{support:!1}})},touchDemo:function(e){n("log",e," at pages\\order\\order.vue:1006"),this.touchStartY=e.changedTouches[0].pageY},touchEndDemo:function(e){n("log",e," at pages\\order\\order.vue:1010")},handleCurrent:function(e,r,t){var n=this;return h(i.default.mark((function r(){var t;return i.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:n.currentIndex=e,t=0==e?n.scrollList[n.currentIndex].id:n.scrollList[n.currentIndex-1].id,n.toChildView=t,n.hasFlag=!0,n.orderList=[],n.i=0,n.orderArr=[],n.orderArrLength=0,n.priceArr=[],n.initOrder(),n.switchTabFlag=!1;case 11:case"end":return r.stop()}}),r)})))()},goToSearch:function(){e.navigateTo({url:"../search/search"})},nowpayOrder:function(e,r){this.waitpayOrderId=e,this.waitPayamount=r,this.initMyInfo(),this.$refs.popupPay.open()},handleCircle:function(e){this.circleShow=e},initMyInfo:function(){var e=this;return h(i.default.mark((function r(){var t;return i.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,e.$fetch(e.$api.currentUser,{},"GET","form");case 2:t=r.sent,e.payInfo[0].sectext="("+Number(t.data.amount).toFixed(2)+")";case 4:case"end":return r.stop()}}),r)})))()},goToStorage:function(r,t){var n={addressDetail:t.startAddress.detail,latitude:t.startAddress.latitude,mobile:t.startAddress.mobile,name:t.startAddress.userName,editAddress:{name:t.startAddress.title,address:t.startAddress.name,latitude:t.startAddress.latitude.split(",")[1],longitude:t.startAddress.latitude.split(",")[0]}},i={addressDetail:t.endAddress.detail,latitude:t.endAddress.latitude,mobile:t.endAddress.mobile,name:t.endAddress.userName,editAddress:{name:t.endAddress.title,address:t.endAddress.name,latitude:t.endAddress.latitude.split(",")[1],longitude:t.endAddress.latitude.split(",")[0]}};e.showModal({title:"重新发单",content:"是否确定重新发单",success:function(s){s.confirm?(e.setStorageSync("sendAddress",JSON.stringify(n)),e.setStorageSync("endAddress",JSON.stringify(i)),e.navigateTo({url:"../storage/storage?car="+r+"&scrollIndex="+t.type})):s.cancel}})},refreshOrder:function(r){var t=this;return h(i.default.mark((function n(){return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.showModal({title:"重新发单",content:"是否确定重新发单",success:function(){var e=h(i.default.mark((function e(n){var s;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!n.confirm){e.next=10;break}return t.deleteId=r.id,e.next=4,t.$fetch(t.$api.orderCreate,{buyAddressType:r.buyAddressType,startAddress:JSON.stringify(r.startAddress),endAddress:JSON.stringify(r.endAddress),tip:r.tip,goodsInventory:r.goodsInventory,distance:r.distance,type:r.type,pickUpType:0,carType:r.carType,incubatorFlag:r.incubatorFlag,premiumFlag:r.premiumFlag,urgentExpressPriceFlag:r.urgentExpressPriceFlag,signForCodeFlag:r.signForCodeFlag,goodsPredictAmount:r.goodsPredictAmount,subsidy:r.subsidy,remark:r.remark},"POST");case 4:s=e.sent,t.waitpayOrderId=s.data,t.waitPayamount=r.payAmount,t.$refs.popupPay.open(),e.next=11;break;case 10:n.cancel;case 11:case"end":return e.stop()}}),e)})));function n(r){return e.apply(this,arguments)}return n}()});case 1:case"end":return n.stop()}}),n)})))()},goToDeatail:function(r,t){var n=this;return h(i.default.mark((function s(){return i.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:n.timerId&&clearTimeout(n.timerId),n.timerId=setTimeout(h(i.default.mark((function s(){var a;return i.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,n.$fetch(n.$api.orderDetail,{id:r},"POST","Form");case 2:a=i.sent,0==a.code&&(3==n.currentIndex||2==n.currentIndex?(e.setStorageSync("orderDetailInfo",JSON.stringify(a.data)),e.navigateTo({url:"../orderDetail/orderDetailing?currentIndex="+n.currentIndex})):e.navigateTo({url:"../orderDetail/orderDetail?orderDetail="+JSON.stringify(a.data)+"&currentIndex="+n.currentIndex+"&payAmount="+t}));case 4:case"end":return i.stop()}}),s)}))),300);case 2:case"end":return s.stop()}}),s)})))()},copyNumber:function(r){e.setClipboardData({data:r,success:function(){}})},goToCancelOrder:function(r,t){this.orderRealyId=r,2===this.currentIndex&&(this.showCancelModel=!this.showCancelModel),t&&e.navigateTo({url:"../cancelOrder/cancelOrder?orderId="+r}),2!==this.currentIndex&&e.navigateTo({url:"../cancelOrder/cancelOrder?orderId="+r})},payOrder:function(r){var t=this;return h(i.default.mark((function n(){var s,a,o;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.showLoading({title:"正在下单中...."}),0!==t.circleShow){n.next=8;break}return n.next=4,t.$fetch(t.$api.orderPay,{orderId:t.waitpayOrderId,payType:t.circleShow},"POST","form");case 4:s=n.sent,0==s.code?(t.initMyInfo(),e.hideLoading(),e.showToast({icon:"success",title:s.msg}),t.$refs.popupPay.close(),setTimeout((function(){6==t.currentIndex&&(t.currentIndex=0),t.handleCurrent(t.currentIndex+1,r)}),1500),setTimeout((function(){6==t.currentIndex&&(t.currentIndex=0),t.handleCurrent(t.currentIndex,r)}),2e3),t.deleteId&&t.deleteOrder(t.deleteId,r,1)):e.showToast({icon:"none",title:s.msg}),n.next=20;break;case 8:if(1!==t.circleShow){n.next=15;break}return n.next=11,t.$fetch(t.$api.orderPay,{orderId:t.waitpayOrderId,payType:t.circleShow},"POST","form");case 11:a=n.sent,e.requestPayment({provider:"alipay",orderInfo:a.msg,success:function(n){e.hideLoading(),e.showToast({icon:"success",title:"支付成功"}),t.$refs.popupPay.close(),setTimeout((function(){6==t.currentIndex&&(t.currentIndex=0),t.handleCurrent(t.currentIndex+1,r)}),1500),setTimeout((function(){6==t.currentIndex&&(t.currentIndex=0),t.handleCurrent(t.currentIndex,r)}),2e3),t.deleteId&&t.deleteOrder(t.deleteId,r,1)},fail:function(r){e.showToast({icon:"none",title:"支付失败"})}}),n.next=20;break;case 15:if(2!==t.circleShow){n.next=20;break}return n.next=18,t.$fetch(t.$api.orderPay,{orderId:t.waitpayOrderId,payType:t.circleShow},"POST","form");case 18:o=n.sent,e.requestPayment({provider:"wxpay",orderInfo:o.data,success:function(n){e.hideLoading(),e.showToast({icon:"success",title:"支付成功"}),t.$refs.popupPay.close(),setTimeout((function(){6==t.currentIndex&&(t.currentIndex=0),t.handleCurrent(t.currentIndex+1,r)}),1500),setTimeout((function(){6==t.currentIndex&&(t.currentIndex=0),t.handleCurrent(t.currentIndex,r)}),2e3),t.deleteId&&t.deleteOrder(t.deleteId,r,1)},fail:function(r){e.showToast({icon:"none",title:"支付失败"})}});case 20:case"end":return n.stop()}}),n)})))()},collectRider:function(r){var t=this;return h(i.default.mark((function n(){var s;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$fetch(t.$api.orderCollection,{riderId:r,type:0},"POST","Form");case 2:s=n.sent,0===s.code&&e.showToast({icon:"success",title:"收藏骑手成功"});case 4:case"end":return n.stop()}}),n)})))()},handleShield:function(r){var t=this;return h(i.default.mark((function n(){return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$fetch(t.$api.orderCollection,{riderId:r,type:1},"POST","Form");case 2:n.sent,e.showToast({icon:"success",title:"屏蔽骑手成功"});case 4:case"end":return n.stop()}}),n)})))()},initOrder:function(){var r=this;return h(i.default.mark((function t(){var s,a;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,r.$fetch(r.$api.orderCustomer,{status:r.scrollList[r.currentIndex].value,displayFlag:1},"POST");case 2:if(s=t.sent,r.resTotal=s.total,0===s.total?r.noOrderText="暂无订单":r.noOrderText="",r.orderList.length<s.total){for(r.hasFlag=!0,r.orderArr=[],a=r.i;a<s.total;a++)r.orderArr=s.rows.slice(r.i,r.i+10);r.orderArrLength+=r.orderArr.length,r.orderArr.forEach((function(e){e.startAddress=JSON.parse(e.startAddress),e.endAddress=JSON.parse(e.endAddress),e.startAddress.addressDetail=e.startAddress.addressDetail.replace("undefined",""),e.endAddress.addressDetail=e.endAddress.addressDetail.replace("undefined","")})),r.orderArrLength<=s.total&&(r.orderList=[].concat(o(r.orderList),o(r.orderArr)),n("log",r.orderList," at pages\\order\\order.vue:1391"),0==r.currentIndex&&(r.swiperItem1=r.orderList),1==r.currentIndex&&(r.swiperItem2=r.orderList),2==r.currentIndex&&(r.orderList.length&&r.orderList.forEach((function(e,t){e.endPickTimer=r.$dayjs(e.pickUpTime).diff(r.$dayjs(),"minute"),clearInterval(r.pickUpTimerFlag[t]),r.pickUpTimerFlag[t]=null,r.pickUpTimerFlag[t]=setInterval((function(){if(n("log","1111"," at pages\\order\\order.vue:1418"),r.$set(r.orderList[t],"endPickTimers",--e.endPickTimer),n("log",e.endPickTimer," at pages\\order\\order.vue:1421"),e.endPickTimer<=0)return e.endPickTimer=0,void r.endOfTime(t)}),6e4)})),r.swiperItem3=r.orderList,n("log",r.swiperItem3," at pages\\order\\order.vue:1433")),3==r.currentIndex&&(r.orderList.length&&r.orderList.forEach((function(e,t){e.estimatedTimeDown=r.$dayjs(e.pickUpTime).diff(r.$dayjs(),"minute"),clearInterval(r.estimatedTimerFlag[t]),r.estimatedTimerFlag[t]=null,r.estimatedTimerFlag[t]=setInterval((function(){if(n("log","1111"," at pages\\order\\order.vue:1449"),r.$set(r.orderList[t],"estimatedTimeDowns",--e.estimatedTimeDown),n("log",e.estimatedTimeDown," at pages\\order\\order.vue:1452"),e.estimatedTimeDown<=0)return e.estimatedTimeDown=0,void r.endOfTime(t)}),6e4)})),r.swiperItem4=r.orderList,n("log",r.orderList," at pages\\order\\order.vue:1463")),4==r.currentIndex&&(r.swiperItem5=r.orderList),5==r.currentIndex&&(r.swiperItem6=r.orderList),6==r.currentIndex&&(r.swiperItem7=r.orderList),7==r.currentIndex&&(r.swiperItem8=r.orderList),r.orderList.length>=s.total&&(r.hasFlag=!1)),setTimeout((function(){e.hideLoading()}),500)}else 0==r.orderList.length&&0==r.currentIndex&&(r.swiperItem1=[]),0==r.orderList.length&&1==r.currentIndex&&(r.swiperItem2=[]),0==r.orderList.length&&2==r.currentIndex&&(r.swiperItem3=[]),0==r.orderList.length&&3==r.currentIndex&&(r.swiperItem4=[]),0==r.orderList.length&&4==r.currentIndex&&(r.swiperItem5=[]),0==r.orderList.length&&5==r.currentIndex&&(r.swiperItem6=[]),0==r.orderList.length&&6==r.currentIndex&&(r.swiperItem7=[]),r.hasFlag=!1;case 6:case"end":return t.stop()}}),t)})))()},endOfTime:function(e){clearInterval(this.pickUpTimerFlag[e]),this.pickUpTimerFlag[e]=null,clearInterval(this.estimatedTimerFlag[e]),this.estimatedTimerFlag[e]=null},goToEvaluate:function(r){e.navigateTo({url:"../evaluate/evaluate?orderId="+r})},deleteOrder:function(r,t,n){var s=this;return h(i.default.mark((function t(){return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!n){t.next=6;break}return t.next=3,s.$fetch(s.$api.orderDisplay,{id:r},"POST","form");case 3:t.sent,t.next=7;break;case 6:e.showModal({title:"删除订单",content:"确定删除订单么?",success:function(){var e=h(i.default.mark((function e(t){var n,a,o,d;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.confirm){e.next=7;break}return e.next=3,s.$fetch(s.$api.orderDisplay,{id:r},"POST","form");case 3:if(n=e.sent,n.data){if(4==s.currentIndex)for(a=0;a<s.swiperItem5.length;a++)s.swiperItem5[a].id==r&&s.swiperItem5.splice(a,1);if(5==s.currentIndex)for(o=0;o<s.swiperItem6.length;o++)s.swiperItem6[o].id==r&&s.swiperItem6.splice(o,1);if(6==s.currentIndex)for(d=0;d<s.swiperItem7.length;d++)s.swiperItem7[d].id==r&&s.swiperItem7.splice(d,1)}e.next=8;break;case 7:t.cancel;case 8:case"end":return e.stop()}}),e)})));function t(r){return e.apply(this,arguments)}return t}()});case 7:case"end":return t.stop()}}),t)})))()},swiperChange:function(e){var r=this;this.timerId&&clearTimeout(this.timerId),this.timerId=setTimeout((function(){if(r.switchTabFlag){r.currentIndex=e.detail.current;var t=0==e.detail.current?r.scrollList[e.detail.current].id:r.scrollList[e.detail.current-1].id;r.toChildView=t,r.hasFlag=!0,r.orderList=[],r.i=0,r.orderArr=[],r.orderArrLength=0,r.priceArr=[],r.scrollLeft=r.currentIndex*r.scrollWidth,r.initOrder()}r.switchTabFlag=!0}),500)},getElSize:function(r){return new Promise((function(t,n){var i=e.createSelectorQuery().select("#"+r);i.fields({size:!0,scrollOffset:!0,rect:!0},(function(e){t(e)})).exec()}))},scrollBottom:function(){this.i+=10,this.hasFlag&&this.initOrder()},watchScrollY:function(e){e.detail.scrollTop<=20?(this.currentWebview.setStyle({pullToRefresh:{support:!1,style:"Android"===plus.os.name?"circle":"default"}}),this.secondsSCT=0):this.currentWebview.setStyle({pullToRefresh:{support:!1}})},closeCancelModel:function(e){this.showCancelModel=!this.showCancelModel},cancelModelProp:function(){var e=this;return h(i.default.mark((function r(){var t;return i.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,e.$fetch(e.$api.orderCancelProp,{},"GET","form");case 2:t=r.sent,e.cancelTimer=t.data.time,e.cancelPrice=t.data.price;case 5:case"end":return r.stop()}}),r)})))()}},onPullDownRefresh:function(){var r=this;setTimeout((function(){r.hasFlag=!0,r.orderList=[],r.i=0,r.orderArr=[],r.orderArrLength=0,r.priceArr=[],r.initOrder(),e.stopPullDownRefresh()}))}};r.default=g}).call(this,t("6e42")["default"],t("0de9")["default"])},9080:function(e,r,t){"use strict";t.r(r);var n=t("7d9f"),i=t.n(n);for(var s in n)"default"!==s&&function(e){t.d(r,e,(function(){return n[e]}))}(s);r["default"]=i.a},"9dd6":function(e,r,t){"use strict";var n=t("5d0d"),i=t.n(n);i.a},ad9e:function(e,r,t){}},[["79df","common/runtime","common/vendor"]]]);