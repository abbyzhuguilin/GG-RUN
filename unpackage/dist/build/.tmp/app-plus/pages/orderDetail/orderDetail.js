(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/orderDetail/orderDetail"],{"0604":function(e,t,r){"use strict";var o=r("ffc4"),n=r.n(o);n.a},"133e":function(e,t,r){"use strict";var o=r("8c05"),n=r.n(o);n.a},"17b8":function(e,t,r){"use strict";r.r(t);var o=r("272e"),n=r("d330");for(var a in n)"default"!==a&&function(e){r.d(t,e,(function(){return n[e]}))}(a);r("0604"),r("133e");var i,s=r("f0c5"),d=Object(s["a"])(n["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],i);t["default"]=d.exports},"272e":function(e,t,r){"use strict";var o={"uni-steps":function(){return r.e("components/uni-steps/uni-steps").then(r.bind(null,"2c29"))},"uni-popup":function(){return r.e("components/uni-popup/uni-popup").then(r.bind(null,"8f1d"))}},n=function(){var e=this,t=e.$createElement;e._self._c},a=[];r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return a})),r.d(t,"a",(function(){return o}))},"89a3":function(e,t,r){"use strict";(function(e,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r("4795")),a=i(r("80ce"));function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t,r,o,n,a,i){try{var s=e[a](i),d=s.value}catch(c){return void r(c)}s.done?t(d):Promise.resolve(d).then(o,n)}function d(e){return function(){var t=this,r=arguments;return new Promise((function(o,n){var a=e.apply(t,r);function i(e){s(a,o,n,i,d,"next",e)}function d(e){s(a,o,n,i,d,"throw",e)}i(void 0)}))}}var c=function(){r.e("components/uni-popup/uni-popup").then(function(){return resolve(r("8f1d"))}.bind(null,r)).catch(r.oe)},l=function(){r.e("components/orderDetailMap").then(function(){return resolve(r("be00"))}.bind(null,r)).catch(r.oe)},u=function(){r.e("components/uni-steps/uni-steps").then(function(){return resolve(r("2c29"))}.bind(null,r)).catch(r.oe)},f={onLoad:function(t){switch(this.cancelModelProp(),e("log",t," at pages\\orderDetail\\orderDetail.vue:351"),this.orderStatus=t.currentIndex,this.orderStatus){case"1":this.stepIndex=0;break;case"2":this.stepIndex=1;break;case"3":this.stepIndex=3;break;case"4":this.stepIndex=5;break;case"5":this.stepIndex=6;break}e("log",this.stepIndex," at pages\\orderDetail\\orderDetail.vue:371"),this.payPrice=t.payAmount;var r=JSON.parse(t.orderDetail);if(r.startAddress=JSON.parse(r.startAddress),r.goodsInventory=JSON.parse(r.goodsInventory),r.endAddress=JSON.parse(r.endAddress),r.startAddress.addressDetail=r.startAddress.addressDetail.replace("undefined",""),r.endAddress.addressDetail=r.endAddress.addressDetail.replace("undefined",""),r.riderAvatar){var o=r.riderAvatar.indexOf("http");-1==o&&(r.riderAvatar=a.default+r.riderAvatar.slice(1,r.riderAvatar.length))}if(r.userAvatar){var n=r.userAvatar.indexOf("http");-1==n&&(r.userAvatar=a.default+r.userAvatar.slice(1,r.userAvatar.length))}switch(this.orderDetailInfo=r,e("log",this.orderDetailInfo," at pages\\orderDetail\\orderDetail.vue:404"),this.covers[0].latitude=this.orderDetailInfo.endAddress.latitude.split(",")[1],this.covers[0].longitude=this.orderDetailInfo.endAddress.latitude.split(",")[0],e("log",this.orderDetailInfo.signForCode," at pages\\orderDetail\\orderDetail.vue:407"),e("log",1==this.orderDetailInfo.signForCode," at pages\\orderDetail\\orderDetail.vue:408"),null==this.orderDetailInfo.signForCode&&(this.orderDetailInfo.signForCode=!1),null==this.orderDetailInfo.pickUpCode&&(this.orderDetailInfo.pickUpCode=!1),2===this.orderDetailInfo.type&&(this.detailPayPrice=Number(this.orderDetailInfo.payAmount-this.orderDetailInfo.goodsPredictAmount).toFixed(2)),this.orderDetailInfo.premium&&(this.elseInfo+=" 保价金"),this.orderDetailInfo.urgentExpressPriceFlag&&(this.elseInfo+=" 加急快送"),this.orderDetailInfo.signForCodeFlag&&(this.elseInfo+=" 签收码"),this.orderDetailInfo.incubatorFlag&&(this.elseInfo+=" 保温箱"),this.elseInfo&&(this.elseInfo=this.elseInfo.slice(1,this.elseInfo.length)),this.orderDetailInfo.orderLevel){case 1:this.orderDetailInfo.orderLevel="一";break;case 2:this.orderDetailInfo.orderLevel="二";break;case 3:this.orderDetailInfo.orderLevel="三";break;case 4:this.orderDetailInfo.orderLevel="四";break;case 5:this.orderDetailInfo.orderLevel="五";break}this.orderDetailInfo.score&&(this.rateActive=Math.floor(this.orderDetailInfo.score/20),this.rate=5-this.rateActive),2!=this.orderStatus&&3!=this.orderStatus&&4!=this.orderStatus&&5!=this.orderStatus||this.initMapInfo()},onHide:function(){this.showCancelButton=!1},components:{uniPopup:c,orderDetailMap:l,uniSteps:u},data:function(){return{stepIndex:0,collect:!1,shield:!1,orderDetailInfo:{},elseInfo:"",orderStatus:"",buyType:["帮我送","帮我取","帮我买"],payInfo:[{image:"../../static/img/my/yuezhifu.png",text:"余额支付",sectext:""},{image:"../../static/img/my/Alipaypayment.png",text:"支付宝支付（推荐）\t",sectext:""},{image:"../../static/img/my/weixinzhifu.png",text:"微信支付",sectext:""}],circleShow:0,rateActive:0,rate:0,covers:[{id:1,latitude:"",longitude:"",iconPath:"../../static/img/index/dingweitwo.png",callout:{content:"终点位置",fontSize:14,display:"ALWAYS"}},{latitude:"",longitude:"",iconPath:"../../static/img/index/kuaidi.png",rotate:75,callout:{content:"骑手位置",fontSize:14,display:"ALWAYS"}}],horsemanInfo:{},horsemanDeg:0,payPrice:0,detailPayPrice:0,points:[],cancelTimer:0,cancelPrice:0,showCancelButton:!1,refreshOrder:0,numList:[{title:"发布订单"},{title:"已接单"},{title:"已收件"},{title:"收件码"},{title:"已送达"},{title:"签收码"},{title:"未评价"}]}},computed:{},methods:{goToCancelOrder:function(e){2==this.orderStatus?this.showCancelButton=!this.showCancelButton:o.navigateTo({url:"../cancelOrder/cancelOrder?orderId="+e})},newGoToCancelOrder:function(e){o.navigateTo({url:"../cancelOrder/cancelOrder?orderId="+e})},showQuestion:function(e){o.showToast({icon:"none",title:e})},cancelModelProp:function(){var e=this;return d(n.default.mark((function t(){var r;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$fetch(e.$api.orderCancelProp,{},"GET","form");case 2:r=t.sent,e.cancelTimer=r.data.time,e.cancelPrice=r.data.price;case 5:case"end":return t.stop()}}),t)})))()},closeCancelModel:function(){this.showCancelButton=!this.showCancelButton},handleCollect:function(){var e=this;return d(n.default.mark((function t(){var r;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(1!==e.orderDetailInfo.shieldType){t.next=3;break}return o.showToast({icon:"none",title:"请取消屏蔽后在进行收藏"}),t.abrupt("return");case 3:if(0===e.orderDetailInfo.shieldType?e.orderDetailInfo.shieldType=-1:-1!==e.orderDetailInfo.shieldType&&""!==e.orderDetailInfo.shieldType||(e.orderDetailInfo.shieldType=0),-1!==e.orderDetailInfo.shieldType){t.next=11;break}return t.next=7,e.$fetch(e.$api.orderCancelCollection,{riderId:e.orderDetailInfo.riderId},"POST","Form");case 7:t.sent,o.showToast({icon:"success",title:"取消收藏"}),t.next=15;break;case 11:return t.next=13,e.$fetch(e.$api.orderCollection,{riderId:e.orderDetailInfo.riderId,type:0},"POST","Form");case 13:r=t.sent,0===r.code&&o.showToast({icon:"success",title:"收藏成功"});case 15:case"end":return t.stop()}}),t)})))()},handleShield:function(){var t=this;return d(n.default.mark((function r(){var a;return n.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(0!==t.orderDetailInfo.shieldType){r.next=3;break}return o.showToast({icon:"none",title:"请取消收藏后在进行屏蔽"}),r.abrupt("return");case 3:if(1===t.orderDetailInfo.shieldType?t.orderDetailInfo.shieldType=-1:-1!==t.orderDetailInfo.shieldType&&""!==t.orderDetailInfo.shieldType||(t.orderDetailInfo.shieldType=1),e("log",t.orderDetailInfo.shieldType," at pages\\orderDetail\\orderDetail.vue:666"),-1!==t.orderDetailInfo.shieldType){r.next=12;break}return r.next=8,t.$fetch(t.$api.orderCancelCollection,{riderId:t.orderDetailInfo.riderId},"POST","Form");case 8:r.sent,o.showToast({icon:"success",title:"取消屏蔽"}),r.next=17;break;case 12:return r.next=14,t.$fetch(t.$api.orderCollection,{riderId:t.orderDetailInfo.riderId,type:1},"POST","Form");case 14:a=r.sent,e("log",a," at pages\\orderDetail\\orderDetail.vue:682"),o.showToast({icon:"success",title:"屏蔽成功"});case 17:case"end":return r.stop()}}),r)})))()},nowpayOrder:function(){this.initMyInfo(),this.refreshOrder=0,this.$refs.popupPay.open()},handleCircle:function(e){this.circleShow=e},initMyInfo:function(){var e=this;return d(n.default.mark((function t(){var r;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$fetch(e.$api.currentUser,{},"GET","form");case 2:r=t.sent,e.payInfo[0].sectext="("+Number(r.data.amount).toFixed(2)+")";case 4:case"end":return t.stop()}}),t)})))()},payOrder:function(){var t=this;return d(n.default.mark((function r(){var a,i,s;return n.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(o.showLoading({title:"正在下单中...."}),0!==t.circleShow){r.next=8;break}return r.next=4,t.$fetch(t.$api.orderPay,{orderId:t.orderDetailInfo.orderId,payType:t.circleShow},"POST","form");case 4:a=r.sent,0==a.code?(o.hideLoading(),o.showToast({icon:"success",title:a.msg}),t.$refs.popupPay.close(),t.refreshOrder?(o.setStorageSync("userSelect",1),setTimeout((function(){o.switchTab({url:"../order/order"})}),1500)):setTimeout((function(){o.navigateBack({delta:1})}),1e3)):o.showToast({icon:"success",title:a.msg}),r.next=20;break;case 8:if(1!==t.circleShow){r.next=15;break}return r.next=11,t.$fetch(t.$api.orderPay,{orderId:t.orderDetailInfo.orderId,payType:t.circleShow},"POST","form");case 11:i=r.sent,o.requestPayment({provider:"alipay",orderInfo:i.msg,success:function(e){o.hideLoading(),o.showToast({icon:"success",title:"支付成功"}),t.$refs.popupPay.close(),t.refreshOrder?(o.setStorageSync("userSelect",1),setTimeout((function(){o.switchTab({url:"../order/order"})}),1500)):setTimeout((function(){o.navigateBack({delta:1})}),1e3)},fail:function(e){o.showToast({icon:"none",title:"支付失败"})}}),r.next=20;break;case 15:if(2!==t.circleShow){r.next=20;break}return r.next=18,t.$fetch(t.$api.orderPay,{orderId:t.orderDetailInfo.orderId,payType:t.circleShow},"POST","form");case 18:s=r.sent,o.requestPayment({provider:"wxpay",orderInfo:s.data,success:function(e){o.hideLoading(),o.showToast({icon:"success",title:"支付成功"}),t.$refs.popupPay.close(),t.refreshOrder?(o.setStorageSync("userSelect",1),setTimeout((function(){o.switchTab({url:"../order/order"})}),1500)):setTimeout((function(){o.navigateBack({delta:1})}),1e3)},fail:function(t){e("log",t," at pages\\orderDetail\\orderDetail.vue:855"),o.showToast({icon:"none",title:"支付失败"})}});case 20:case"end":return r.stop()}}),r)})))()},copyPickUpCode:function(t){o.setClipboardData({data:t,success:function(){e("log","success"," at pages\\orderDetail\\orderDetail.vue:871")}})},callPhone:function(e){o.makePhoneCall({phoneNumber:e})},copyOrderNo:function(t){o.setClipboardData({data:t,success:function(){e("log","success"," at pages\\orderDetail\\orderDetail.vue:886")}})},goToEvaluate:function(){o.navigateTo({url:"../evaluate/evaluate?orderId="+this.orderDetailInfo.orderId})},goTofreight:function(e){o.navigateTo({url:"../freightDeatail/freightDeatail?freightInfo="+JSON.stringify(this.orderDetailInfo)+"&status="+e})},showImgPage:function(){o.navigateTo({url:"./shopInfoImg?imgList="+this.orderDetailInfo.goodsInventory.pics})},commitDelivery:function(){var t=this;o.showModal({title:"确认收货",content:"请确保您已收到货物",success:function(){var r=d(n.default.mark((function r(a){var i;return n.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!a.confirm){r.next=9;break}return r.next=3,t.$fetch(t.$api.orderConfirm,{orderId:t.orderDetailInfo.orderId},"POST","Form");case 3:i=r.sent,e("log",i," at pages\\orderDetail\\orderDetail.vue:920"),o.showToast({icon:"success",title:"成功收货"}),setTimeout((function(){o.switchTab({url:"../order/order",success:function(){var e=getCurrentPages().pop();e&&e.onLoad()}})}),1e3),r.next=10;break;case 9:a.cancel;case 10:case"end":return r.stop()}}),r)})));function a(e){return r.apply(this,arguments)}return a}()})},initMapInfo:function(){var t=this;e("log",this.orderDetailInfo," at pages\\orderDetail\\orderDetail.vue:943"),e("log",this.orderDetailInfo.tid," at pages\\orderDetail\\orderDetail.vue:944"),o.request({url:"https://tsapi.amap.com/v1/track/terminal/search",method:"POST",data:{key:"4145121d3d1b5dcf41702960f3bd5adc",sid:"126730",keywords:this.orderDetailInfo.riderId},header:{"content-type":"application/x-www-form-urlencoded"},success:function(r){e("log",r," at pages\\orderDetail\\orderDetail.vue:959"),t.horsemanInfo=r.data.data,t.covers[1].latitude=t.horsemanInfo.results[0].location.latitude,t.covers[1].longitude=t.horsemanInfo.results[0].location.longitude,t.privatedouble(t.covers[1].latitude,t.covers[1].longitude,t.covers[0].latitude,t.covers[0].longitude),t.points=[{latitude:t.covers[0].latitude,longitude:t.covers[0].longitude},{latitude:t.covers[1].latitude,longitude:t.covers[1].longitude}]}})},goToStorage:function(t){var r=this;e("log",t," at pages\\orderDetail\\orderDetail.vue:977"),o.showModal({title:"重新发单",content:"是否确定重新发单",success:function(){var o=d(n.default.mark((function o(a){var i;return n.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(!a.confirm){o.next=13;break}return e("log",t.orderId," at pages\\orderDetail\\orderDetail.vue:983"),o.next=4,r.$fetch(r.$api.orderCreate,{buyAddressType:t.buyAddressType,startAddress:JSON.stringify(t.startAddress),endAddress:JSON.stringify(t.endAddress),tip:t.tip,goodsInventory:JSON.stringify(t.goodsInventory),distance:t.distance,type:t.type,pickUpType:0,carType:t.carType,incubatorFlag:t.incubatorFlag,premiumFlag:t.premiumFlag,urgentExpressPriceFlag:t.urgentExpressPriceFlag,signForCodeFlag:t.signForCodeFlag,goodsPredictAmount:t.goodsPredictAmount,subsidy:t.subsidy,remark:t.remark},"POST");case 4:return i=o.sent,r.refreshOrder=1,o.next=8,r.$fetch(r.$api.orderDisplay,{id:t.orderId},"POST","form");case 8:o.sent,r.orderDetailInfo.orderId=i.data,r.$refs.popupPay.open(),o.next=14;break;case 13:a.cancel&&e("log","用户点击取消"," at pages\\orderDetail\\orderDetail.vue:1010");case 14:case"end":return o.stop()}}),o)})));function a(e){return o.apply(this,arguments)}return a}()})},privatedouble:function(e,t,r,o){var n=0;return e=e*Math.PI/180,t=t*Math.PI/180,r=r*Math.PI/180,o=o*Math.PI/180,n=Math.sin(e)*Math.sin(r)+Math.cos(e)*Math.cos(r)*Math.cos(o-t),n=Math.sqrt(1-n*n),n=Math.cos(r)*Math.sin(o-t)/n,n=180*Math.asin(n)/Math.PI,n}}};t.default=f}).call(this,r("0de9")["default"],r("6e42")["default"])},"8c05":function(e,t,r){},ada5:function(e,t,r){"use strict";(function(e){r("7207"),r("921b");o(r("66fd"));var t=o(r("17b8"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,r("6e42")["createPage"])},d330:function(e,t,r){"use strict";r.r(t);var o=r("89a3"),n=r.n(o);for(var a in o)"default"!==a&&function(e){r.d(t,e,(function(){return o[e]}))}(a);t["default"]=n.a},ffc4:function(e,t,r){}},[["ada5","common/runtime","common/vendor"]]]);