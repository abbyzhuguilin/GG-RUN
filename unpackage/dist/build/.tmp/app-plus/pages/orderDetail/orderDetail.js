(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/orderDetail/orderDetail"],{"0418":function(e,t,r){"use strict";(function(e){r("6857"),r("921b");i(r("66fd"));var t=i(r("110a"));function i(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,r("6e42")["createPage"])},"0629":function(e,t,r){},"110a":function(e,t,r){"use strict";r.r(t);var i=r("9ac2"),o=r("945b");for(var n in o)"default"!==n&&function(e){r.d(t,e,(function(){return o[e]}))}(n);r("598b"),r("168b");var a,s=r("f0c5"),d=Object(s["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],a);t["default"]=d.exports},"168b":function(e,t,r){"use strict";var i=r("3ae5"),o=r.n(i);o.a},"3ae5":function(e,t,r){},"598b":function(e,t,r){"use strict";var i=r("0629"),o=r.n(i);o.a},"945b":function(e,t,r){"use strict";r.r(t);var i=r("996d"),o=r.n(i);for(var n in i)"default"!==n&&function(e){r.d(t,e,(function(){return i[e]}))}(n);t["default"]=o.a},"996d":function(e,t,r){"use strict";(function(e,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(r("a34a")),n=a(r("14ad"));function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t,r,i,o,n,a){try{var s=e[n](a),d=s.value}catch(c){return void r(c)}s.done?t(d):Promise.resolve(d).then(i,o)}function d(e){return function(){var t=this,r=arguments;return new Promise((function(i,o){var n=e.apply(t,r);function a(e){s(n,i,o,a,d,"next",e)}function d(e){s(n,i,o,a,d,"throw",e)}a(void 0)}))}}var c=function(){r.e("components/uni-popup/uni-popup").then(function(){return resolve(r("0a69"))}.bind(null,r)).catch(r.oe)},l=function(){r.e("components/orderDetailMap").then(function(){return resolve(r("ab93"))}.bind(null,r)).catch(r.oe)},u=function(){r.e("components/uni-steps/uni-steps").then(function(){return resolve(r("0499"))}.bind(null,r)).catch(r.oe)},h={onLoad:function(t){switch(e.setStorageSync("starSetIntertFlag",!0),this.cancelModelProp(),i("log",t," at pages\\orderDetail\\orderDetail.vue:352"),this.orderStatus=t.currentIndex,this.orderStatus){case"1":this.stepIndex=0;break;case"2":this.stepIndex=1;break;case"3":this.stepIndex=3;break;case"4":this.stepIndex=5;break;case"5":this.stepIndex=6;break}i("log",this.stepIndex," at pages\\orderDetail\\orderDetail.vue:372"),6==this.stepIndex&&(this.numList[6].title="已评价"),this.payPrice=t.payAmount;var r=JSON.parse(t.orderDetail);if(r.startAddress=JSON.parse(r.startAddress),r.goodsInventory=JSON.parse(r.goodsInventory),r.endAddress=JSON.parse(r.endAddress),r.startAddress.addressDetail=r.startAddress.addressDetail.replace("undefined",""),r.endAddress.addressDetail=r.endAddress.addressDetail.replace("undefined",""),r.riderAvatar){var o=r.riderAvatar.indexOf("http");-1==o&&(r.riderAvatar=n.default+r.riderAvatar.slice(1,r.riderAvatar.length))}if(r.userAvatar){var a=r.userAvatar.indexOf("http");-1==a&&(r.userAvatar=n.default+r.userAvatar.slice(1,r.userAvatar.length))}switch(this.orderDetailInfo=r,i("log",this.orderDetailInfo," at pages\\orderDetail\\orderDetail.vue:423"),this.covers[0].latitude=this.orderDetailInfo.endAddress.latitude.split(",")[1],this.covers[0].longitude=this.orderDetailInfo.endAddress.latitude.split(",")[0],i("log",this.orderDetailInfo.signForCode," at pages\\orderDetail\\orderDetail.vue:426"),i("log",1==this.orderDetailInfo.signForCode," at pages\\orderDetail\\orderDetail.vue:427"),null==this.orderDetailInfo.signForCode&&(this.orderDetailInfo.signForCode=!1),null==this.orderDetailInfo.pickUpCode&&(this.orderDetailInfo.pickUpCode=!1),2===this.orderDetailInfo.type&&(this.detailPayPrice=Number(this.orderDetailInfo.payAmount-this.orderDetailInfo.goodsPredictAmount).toFixed(2)),this.orderDetailInfo.premium&&(this.elseInfo+=" 保价金"),this.orderDetailInfo.urgentExpressPriceFlag&&(this.elseInfo+=" 加急快送"),this.orderDetailInfo.signForCodeFlag&&(this.elseInfo+=" 签收码"),this.orderDetailInfo.incubatorFlag&&(this.elseInfo+=" 保温箱"),this.elseInfo&&(this.elseInfo=this.elseInfo.slice(1,this.elseInfo.length)),this.orderDetailInfo.orderLevel){case 1:this.orderDetailInfo.orderLevel="一";break;case 2:this.orderDetailInfo.orderLevel="二";break;case 3:this.orderDetailInfo.orderLevel="三";break;case 4:this.orderDetailInfo.orderLevel="四";break;case 5:this.orderDetailInfo.orderLevel="五";break}this.orderDetailInfo.score&&(this.rateActive=Math.floor(this.orderDetailInfo.score/20),this.rate=5-this.rateActive),2!=this.orderStatus&&3!=this.orderStatus&&4!=this.orderStatus&&5!=this.orderStatus||this.initMapInfo()},onHide:function(){this.showCancelButton=!1},components:{uniPopup:c,orderDetailMap:l,uniSteps:u},data:function(){return{stepIndex:0,collect:!1,shield:!1,orderDetailInfo:{},elseInfo:"",orderStatus:"",buyType:["帮我送","帮我取","帮我买"],payInfo:[{image:"../../static/img/my/yuezhifu.png",text:"余额支付",sectext:""},{image:"../../static/img/my/Alipaypayment.png",text:"支付宝支付（推荐）\t",sectext:""},{image:"../../static/img/my/weixinzhifu.png",text:"微信支付",sectext:""}],circleShow:0,rateActive:0,rate:0,covers:[{id:1,latitude:"",longitude:"",iconPath:"../../static/img/index/dingweitwo.png",callout:{content:"终点位置",fontSize:14,display:"ALWAYS"}},{latitude:"",longitude:"",iconPath:"../../static/img/index/kuaidi.png",rotate:75,callout:{content:"骑手位置",fontSize:14,display:"ALWAYS"}}],horsemanInfo:{},horsemanDeg:0,payPrice:0,detailPayPrice:0,points:[],cancelTimer:0,cancelPrice:0,showCancelButton:!1,refreshOrder:0,numList:[{title:"发布订单"},{title:"已接单"},{title:"已收件"},{title:"收件码"},{title:"已送达"},{title:"签收码"},{title:"未评价"}]}},computed:{},methods:{goToCancelOrder:function(t){2==this.orderStatus?this.showCancelButton=!this.showCancelButton:e.navigateTo({url:"../cancelOrder/cancelOrder?orderId="+t})},newGoToCancelOrder:function(t){e.navigateTo({url:"../cancelOrder/cancelOrder?orderId="+t})},showQuestion:function(t){e.showToast({icon:"none",title:t})},cancelModelProp:function(){var e=d(o.default.mark((function e(){var t;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$fetch(this.$api.orderCancelProp,{},"GET","form");case 2:t=e.sent,this.cancelTimer=t.data.time,this.cancelPrice=t.data.price;case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),closeCancelModel:function(){this.showCancelButton=!this.showCancelButton},handleCollect:function(){var t=d(o.default.mark((function t(){var r;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(1!==this.orderDetailInfo.shieldType){t.next=3;break}return e.showToast({icon:"none",title:"请取消屏蔽后在进行收藏"}),t.abrupt("return");case 3:if(0===this.orderDetailInfo.shieldType?this.orderDetailInfo.shieldType=-1:-1!==this.orderDetailInfo.shieldType&&""!==this.orderDetailInfo.shieldType||(this.orderDetailInfo.shieldType=0),-1!==this.orderDetailInfo.shieldType){t.next=11;break}return t.next=7,this.$fetch(this.$api.orderCancelCollection,{riderId:this.orderDetailInfo.riderId},"POST","Form");case 7:t.sent,e.showToast({icon:"success",title:"取消收藏"}),t.next=15;break;case 11:return t.next=13,this.$fetch(this.$api.orderCollection,{riderId:this.orderDetailInfo.riderId,type:0},"POST","Form");case 13:r=t.sent,0===r.code&&e.showToast({icon:"success",title:"收藏成功"});case 15:case"end":return t.stop()}}),t,this)})));function r(){return t.apply(this,arguments)}return r}(),handleShield:function(){var t=d(o.default.mark((function t(){var r;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0!==this.orderDetailInfo.shieldType){t.next=3;break}return e.showToast({icon:"none",title:"请取消收藏后在进行屏蔽"}),t.abrupt("return");case 3:if(1===this.orderDetailInfo.shieldType?this.orderDetailInfo.shieldType=-1:-1!==this.orderDetailInfo.shieldType&&""!==this.orderDetailInfo.shieldType||(this.orderDetailInfo.shieldType=1),i("log",this.orderDetailInfo.shieldType," at pages\\orderDetail\\orderDetail.vue:685"),-1!==this.orderDetailInfo.shieldType){t.next=12;break}return t.next=8,this.$fetch(this.$api.orderCancelCollection,{riderId:this.orderDetailInfo.riderId},"POST","Form");case 8:t.sent,e.showToast({icon:"success",title:"取消屏蔽"}),t.next=17;break;case 12:return t.next=14,this.$fetch(this.$api.orderCollection,{riderId:this.orderDetailInfo.riderId,type:1},"POST","Form");case 14:r=t.sent,i("log",r," at pages\\orderDetail\\orderDetail.vue:701"),e.showToast({icon:"success",title:"屏蔽成功"});case 17:case"end":return t.stop()}}),t,this)})));function r(){return t.apply(this,arguments)}return r}(),nowpayOrder:function(){this.initMyInfo(),this.refreshOrder=0,this.$refs.popupPay.open()},handleCircle:function(e){this.circleShow=e},initMyInfo:function(){var e=d(o.default.mark((function e(){var t;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$fetch(this.$api.currentUser,{},"GET","form");case 2:t=e.sent,this.payInfo[0].sectext="("+Number(t.data.amount).toFixed(2)+")";case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),payOrder:function(){var t=d(o.default.mark((function t(){var r,n,a,s=this;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.showLoading({title:"正在下单中...."}),0!==this.circleShow){t.next=8;break}return t.next=4,this.$fetch(this.$api.orderPay,{orderId:this.orderDetailInfo.orderId,payType:this.circleShow},"POST","form");case 4:r=t.sent,0==r.code?(e.hideLoading(),e.showToast({icon:"success",title:r.msg}),this.$refs.popupPay.close(),this.refreshOrder?(e.setStorageSync("userSelect",1),setTimeout((function(){e.switchTab({url:"../order/order"})}),1500)):setTimeout((function(){e.navigateBack({delta:1})}),1e3)):e.showToast({icon:"success",title:r.msg}),t.next=20;break;case 8:if(1!==this.circleShow){t.next=15;break}return t.next=11,this.$fetch(this.$api.orderPay,{orderId:this.orderDetailInfo.orderId,payType:this.circleShow},"POST","form");case 11:n=t.sent,e.requestPayment({provider:"alipay",orderInfo:n.msg,success:function(t){e.hideLoading(),e.showToast({icon:"success",title:"支付成功"}),s.$refs.popupPay.close(),s.refreshOrder?(e.setStorageSync("userSelect",1),setTimeout((function(){e.switchTab({url:"../order/order"})}),1500)):setTimeout((function(){e.navigateBack({delta:1})}),1e3)},fail:function(t){e.showToast({icon:"none",title:"支付失败"})}}),t.next=20;break;case 15:if(2!==this.circleShow){t.next=20;break}return t.next=18,this.$fetch(this.$api.orderPay,{orderId:this.orderDetailInfo.orderId,payType:this.circleShow},"POST","form");case 18:a=t.sent,e.requestPayment({provider:"wxpay",orderInfo:a.data,success:function(t){e.hideLoading(),e.showToast({icon:"success",title:"支付成功"}),s.$refs.popupPay.close(),s.refreshOrder?(e.setStorageSync("userSelect",1),setTimeout((function(){e.switchTab({url:"../order/order"})}),1500)):setTimeout((function(){e.navigateBack({delta:1})}),1e3)},fail:function(t){i("log",t," at pages\\orderDetail\\orderDetail.vue:874"),e.showToast({icon:"none",title:"支付失败"})}});case 20:case"end":return t.stop()}}),t,this)})));function r(){return t.apply(this,arguments)}return r}(),copyPickUpCode:function(t){e.setClipboardData({data:t,success:function(){i("log","success"," at pages\\orderDetail\\orderDetail.vue:890")}})},callPhone:function(t){e.makePhoneCall({phoneNumber:t})},copyOrderNo:function(t){e.setClipboardData({data:t,success:function(){i("log","success"," at pages\\orderDetail\\orderDetail.vue:905")}})},goToEvaluate:function(){e.navigateTo({url:"../evaluate/evaluate?orderId="+this.orderDetailInfo.orderId})},goTofreight:function(t){e.navigateTo({url:"../freightDeatail/freightDeatail?freightInfo="+JSON.stringify(this.orderDetailInfo)+"&status="+t})},showImgPage:function(){e.navigateTo({url:"./shopInfoImg?imgList="+this.orderDetailInfo.goodsInventory.pics})},commitDelivery:function(){var t=this;e.showModal({title:"确认收货",content:"请确保您已收到货物",success:function(){var r=d(o.default.mark((function r(n){var a;return o.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!n.confirm){r.next=9;break}return r.next=3,t.$fetch(t.$api.orderConfirm,{orderId:t.orderDetailInfo.orderId},"POST","Form");case 3:a=r.sent,i("log",a," at pages\\orderDetail\\orderDetail.vue:939"),e.showToast({icon:"success",title:"成功收货"}),setTimeout((function(){e.switchTab({url:"../order/order",success:function(){var e=getCurrentPages().pop();e&&e.onLoad()}})}),1e3),r.next=10;break;case 9:n.cancel;case 10:case"end":return r.stop()}}),r)})));function n(e){return r.apply(this,arguments)}return n}()})},initMapInfo:function(){var t=this;i("log",this.orderDetailInfo," at pages\\orderDetail\\orderDetail.vue:962"),i("log",this.orderDetailInfo.tid," at pages\\orderDetail\\orderDetail.vue:963"),e.request({url:"https://tsapi.amap.com/v1/track/terminal/search",method:"POST",data:{key:"4145121d3d1b5dcf41702960f3bd5adc",sid:"126730",keywords:this.orderDetailInfo.riderId},header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){i("log",e," at pages\\orderDetail\\orderDetail.vue:978"),t.horsemanInfo=e.data.data,t.covers[1].latitude=t.horsemanInfo.results[0].location.latitude,t.covers[1].longitude=t.horsemanInfo.results[0].location.longitude,t.privatedouble(t.covers[1].latitude,t.covers[1].longitude,t.covers[0].latitude,t.covers[0].longitude),t.points=[{latitude:t.covers[0].latitude,longitude:t.covers[0].longitude},{latitude:t.covers[1].latitude,longitude:t.covers[1].longitude}]}})},goToStorage:function(t){var r=this;i("log",t," at pages\\orderDetail\\orderDetail.vue:996"),e.showModal({title:"重新发单",content:"是否确定重新发单",success:function(){var e=d(o.default.mark((function e(n){var a;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!n.confirm){e.next=13;break}return i("log",t.orderId," at pages\\orderDetail\\orderDetail.vue:1002"),e.next=4,r.$fetch(r.$api.orderCreate,{buyAddressType:t.buyAddressType,startAddress:JSON.stringify(t.startAddress),endAddress:JSON.stringify(t.endAddress),tip:t.tip,goodsInventory:JSON.stringify(t.goodsInventory),distance:t.distance,type:t.type,pickUpType:0,carType:t.carType,incubatorFlag:t.incubatorFlag,premiumFlag:t.premiumFlag,urgentExpressPriceFlag:t.urgentExpressPriceFlag,signForCodeFlag:t.signForCodeFlag,goodsPredictAmount:t.goodsPredictAmount,subsidy:t.subsidy,remark:t.remark},"POST");case 4:return a=e.sent,r.refreshOrder=1,e.next=8,r.$fetch(r.$api.orderDisplay,{id:t.orderId},"POST","form");case 8:e.sent,r.orderDetailInfo.orderId=a.data,r.$refs.popupPay.open(),e.next=14;break;case 13:n.cancel&&i("log","用户点击取消"," at pages\\orderDetail\\orderDetail.vue:1029");case 14:case"end":return e.stop()}}),e)})));function n(t){return e.apply(this,arguments)}return n}()})},privatedouble:function(e,t,r,i){var o=0;return e=e*Math.PI/180,t=t*Math.PI/180,r=r*Math.PI/180,i=i*Math.PI/180,o=Math.sin(e)*Math.sin(r)+Math.cos(e)*Math.cos(r)*Math.cos(i-t),o=Math.sqrt(1-o*o),o=Math.cos(r)*Math.sin(i-t)/o,o=180*Math.asin(o)/Math.PI,o}}};t.default=h}).call(this,r("6e42")["default"],r("0de9")["default"])},"9ac2":function(e,t,r){"use strict";var i={"uni-steps":function(){return r.e("components/uni-steps/uni-steps").then(r.bind(null,"0499"))},"uni-popup":function(){return r.e("components/uni-popup/uni-popup").then(r.bind(null,"0a69"))}},o=function(){var e=this,t=e.$createElement;e._self._c},n=[];r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return n})),r.d(t,"a",(function(){return i}))}},[["0418","common/runtime","common/vendor"]]]);